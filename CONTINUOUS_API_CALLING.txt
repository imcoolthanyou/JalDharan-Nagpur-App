â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              âœ… CONTINUOUS API CALLING IMPLEMENTED âœ…
                 HomeScreen & AnalyticsScreen Auto-Refresh
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

WHAT WAS UPDATED:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… HomeScreen (Already had this)
   - Fetches API data every 10 seconds continuously
   - Starts timer in initState()
   - Cancels timer in dispose()
   - Shows loading state during fetch

âœ… AnalyticsScreen (Just updated)
   - Now fetches API data every 10 seconds continuously
   - Starts timer in initState()
   - Cancels timer in dispose()
   - Updates graph with latest predictions
   - Shows loading state during fetch

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

HOW IT WORKS:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Timeline for Each Screen:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

0 sec:    Screen opens
          â””â”€ initState() runs
          â””â”€ Loads initial data (from parameter or mock)
          â””â”€ Starts auto-refresh timer
          â””â”€ UI displayed immediately

1-2 sec:  First API call completes
          â””â”€ Fresh data from server arrives
          â””â”€ UI updates with real data

10 sec:   Timer triggers automatically â±ï¸
          â””â”€ API called again
          â””â”€ New data fetched

11-12 sec: API response received
          â””â”€ Graph updates
          â””â”€ Predictions refresh
          â””â”€ UI rebuilds with latest values

20 sec:   Timer triggers again â±ï¸
          â””â”€ Another API call
          â””â”€ Cycle continues...

...continues until user navigates away

User navigates away:
          â””â”€ dispose() called
          â””â”€ Timer cancelled
          â””â”€ No more API calls
          â””â”€ Resources cleaned up

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

HOMESCREEN AUTO-REFRESH:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

File: lib/presentation/screens/home/home_screen.dart

Features:
  âœ“ 10-second refresh interval
  âœ“ Smart data change detection
  âœ“ Only rebuilds UI if values changed
  âœ“ Shows loading state
  âœ“ Error handling with retry

How it works:
  1. initState() â†’ _startAutoRefresh()
  2. Timer.periodic() â†’ Triggers every 10 seconds
  3. _fetchDashboardData() â†’ Calls API
  4. _hasDataChanged() â†’ Checks if values different
  5. setState() â†’ Updates UI only if needed
  6. dispose() â†’ Cancels timer

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ANALYTICSSCREEN AUTO-REFRESH:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

File: lib/presentation/screens/analytics/analytics_screen.dart

Features:
  âœ“ 10-second refresh interval (same as HomeScreen)
  âœ“ Fetches latest groundwater predictions
  âœ“ Updates graph visualization
  âœ“ Shows loading state
  âœ“ Error handling

How it works:
  1. initState() â†’ _startAutoRefresh()
  2. Timer.periodic() â†’ Triggers every 10 seconds
  3. _fetchLatestData() â†’ Calls API
  4. _createGroundwaterTrendFromData() â†’ Parses new predictions
  5. setState() â†’ Updates graph with latest data
  6. dispose() â†’ Cancels timer

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CODE STRUCTURE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

HomeScreen Pattern:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  class _HomeScreenState extends State<HomeScreen> {
    late Timer _autoRefreshTimer;
    static const Duration _refreshInterval = Duration(seconds: 10);

    @override
    void initState() {
      super.initState();
      _startAutoRefresh();
    }

    void _startAutoRefresh() {
      _autoRefreshTimer = Timer.periodic(_refreshInterval, (_) {
        if (mounted) {
          _fetchDashboardData();
        }
      });
    }

    @override
    void dispose() {
      _autoRefreshTimer.cancel();
      super.dispose();
    }
  }

AnalyticsScreen Pattern (Same):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  class _AnalyticsScreenState extends State<AnalyticsScreen> {
    late Timer _autoRefreshTimer;
    static const Duration _refreshInterval = Duration(seconds: 10);

    @override
    void initState() {
      super.initState();
      _startAutoRefresh();
    }

    void _startAutoRefresh() {
      _autoRefreshTimer = Timer.periodic(_refreshInterval, (_) {
        if (mounted) {
          _fetchLatestData();
        }
      });
    }

    @override
    void dispose() {
      _autoRefreshTimer.cancel();
      super.dispose();
    }
  }

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

API CALLS FREQUENCY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

HomeScreen:
  â””â”€ API calls every 10 seconds
  â””â”€ Endpoint: /mobile/dashboard
  â””â”€ Response: Current sensor data + predictions

AnalyticsScreen:
  â””â”€ API calls every 10 seconds
  â””â”€ Endpoint: /mobile/dashboard (same)
  â””â”€ Uses: groundwater_trend predictions
  â””â”€ Displays: 30-day forecast graph

Total API Load:
  â””â”€ If both screens open simultaneously:
     â€¢ 2 API calls per 10 seconds (HomeScreen + AnalyticsScreen)
     â€¢ But typically only one visible screen at a time
     â€¢ When navigating away, timer cancels â†’ No calls

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

WHAT GETS UPDATED:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

HomeScreen Updates Every 10 Seconds:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  âœ“ Current water depth
  âœ“ Flow rate
  âœ“ TDS level
  âœ“ pH level
  âœ“ Power consumption (kW)
  âœ“ Pump status
  âœ“ Water stress level
  âœ“ 7/14/30-day predictions
  âœ“ Water quality score
  âœ“ Last updated timestamp

AnalyticsScreen Updates Every 10 Seconds:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  âœ“ Current depth value
  âœ“ 7-day predicted depth
  âœ“ 14-day predicted depth
  âœ“ 30-day predicted depth
  âœ“ Trend direction (falling/rising/stable)
  âœ“ Water stress level
  âœ“ Graph visualization
  âœ“ AI analysis card data

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

EFFICIENCY:
â•â•â•â•â•â•â•â•â•â•â•â•

Smart Update Detection:

HomeScreen uses _hasDataChanged() to check if values different:
  âœ“ Only rebuilds if new values received
  âœ“ No unnecessary UI updates
  âœ“ Smooth, flicker-free experience

AnalyticsScreen updates graph automatically:
  âœ“ Processes latest API response
  âœ“ Creates new TrendData
  âœ“ Graph re-renders smoothly
  âœ“ Loading state manages transitions

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CONFIGURATION:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Change refresh interval (default: 10 seconds):

HomeScreen:
  static const Duration _refreshInterval = Duration(seconds: 10);

  â†’ Change 10 to your desired seconds:
  â†’ Duration(seconds: 5) for 5-second refresh
  â†’ Duration(seconds: 30) for 30-second refresh

AnalyticsScreen:
  static const Duration _refreshInterval = Duration(seconds: 10);

  â†’ Same pattern, change to match your needs

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

MEMORY SAFETY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Timer is always cancelled in dispose()
   â†’ No memory leaks
   â†’ Resources properly cleaned up

âœ… mounted check before setState()
   â†’ Prevents "setState after dispose" errors

âœ… If user navigates away:
   â†’ dispose() immediately cancels timer
   â†’ No more API calls
   â†’ Battery efficient

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TESTING:
â•â•â•â•â•â•â•â•â•

How to verify continuous API calling:

1. Open HomeScreen
   â””â”€ Watch "Last Updated" timestamp
   â””â”€ Should update every 10 seconds
   â””â”€ Values should change if backend data changes

2. Open AnalyticsScreen
   â””â”€ Watch prediction graph
   â””â”€ Should refresh every 10 seconds
   â””â”€ Values should update smoothly

3. Check backend logs
   â””â”€ Should see API calls every 10 seconds
   â””â”€ One from HomeScreen + one from AnalyticsScreen (if both open)

4. Check network requests
   â””â”€ In DevTools network tab
   â””â”€ See periodic POST requests to /mobile/dashboard

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ERROR HANDLING:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

If API fails during refresh:

HomeScreen:
  âœ“ Shows snackbar with error message
  âœ“ User can tap "Retry"
  âœ“ Timer continues (will try again in 10 seconds)
  âœ“ Previous data stays visible

AnalyticsScreen:
  âœ“ Silently logs error to console
  âœ“ Previous graph stays visible
  âœ“ Timer continues (will try again in 10 seconds)
  âœ“ No error UI (assuming predictions are stable)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SUMMARY:
â•â•â•â•â•â•â•â•â•

âœ… HomeScreen: Continuously fetches data every 10 seconds
âœ… AnalyticsScreen: Continuously fetches data every 10 seconds
âœ… Both use same API endpoint: /mobile/dashboard
âœ… Both have proper memory management
âœ… Both have error handling
âœ… Both cancel timers on navigate away
âœ… Real-time data updates with smart change detection
âœ… Smooth, efficient, production-ready

Your app now has real-time data streaming! ğŸš€

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
